{"version":3,"sources":["kaleidoscope.js"],"names":["makeKaleidoscope","element","DragDrop","Kaleidoscope","c","dragger","gui","i","image","kaleidoscope","len","onChange","onMouseMoved","options","ref","tr","tx","ty","update","options1","key","ref1","val","defaults","offsetRotation","offsetScale","offsetX","offsetY","radius","clientWidth","slices","zoom","domElement","document","createElement","context","getContext","cx","index","results","scale","step","width","height","fillStyle","createPattern","Math","min","TWO_PI","save","translate","rotate","beginPath","moveTo","arc","lineTo","closePath","HALF_PI","fill","push","restore","prototype","PI","call","callback","filter","disable","onDrop","bind","event","stopPropagation","preventDefault","addEventListener","file","reader","dataTransfer","files","test","type","FileReader","onload","target","result","readAsDataURL","Image","draw","src","style","display","appendChild","data","cy","dx","dy","hx","hy","window","innerWidth","innerHeight","pageX","pageY","atan2","interactive","ease","delta","theta","sin","cos","setTimeout","marginLeft","marginTop"],"mappings":"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","file":"kaleidoscope.js","sourcesContent":["let makeKaleidoscope = (function(element) {\n    // Kaleidoscope\n    var DragDrop, Kaleidoscope, c, dragger, gui, i, image, kaleidoscope, len, onChange, onMouseMoved, options, ref, tr, tx, ty, update;\n  \n    Kaleidoscope = (function() {\n      class Kaleidoscope {\n        constructor(options1 = {}) {\n          var key, ref, ref1, val;\n          this.options = options1;\n          this.defaults = {\n            offsetRotation: 0.0,\n            offsetScale: 1.0,\n            offsetX: 0.0,\n            offsetY: 0.0,\n            radius: element.clientWidth/2,\n            slices: 12,\n            zoom: 1.0\n          };\n          ref = this.defaults;\n          for (key in ref) {\n            val = ref[key];\n            this[key] = val;\n          }\n          ref1 = this.options;\n          for (key in ref1) {\n            val = ref1[key];\n            this[key] = val;\n          }\n          if (this.domElement == null) {\n            this.domElement = document.createElement('canvas');\n          }\n          if (this.context == null) {\n            this.context = this.domElement.getContext('2d');\n          }\n          if (this.image == null) {\n            this.image = document.createElement('img');\n          }\n        }\n  \n        draw() {\n          var cx, i, index, ref, results, scale, step;\n          this.domElement.width = this.domElement.height = this.radius * 2;\n          this.context.fillStyle = this.context.createPattern(this.image, 'repeat');\n          scale = this.zoom * (this.radius / Math.min(this.image.width, this.image.height));\n          step = this.TWO_PI / this.slices;\n          cx = this.image.width / 2;\n          results = [];\n          for (index = i = 0, ref = this.slices; (0 <= ref ? i <= ref : i >= ref); index = 0 <= ref ? ++i : --i) {\n            this.context.save();\n            this.context.translate(this.radius, this.radius);\n            this.context.rotate(index * step);\n            this.context.beginPath();\n            this.context.moveTo(-0.5, -0.5);\n            this.context.arc(0, 0, this.radius, step * -0.51, step * 0.51);\n            this.context.lineTo(0.5, 0.5);\n            this.context.closePath();\n            this.context.rotate(this.HALF_PI);\n            this.context.scale(scale, scale);\n            this.context.scale([-1, 1][index % 2], 1);\n            this.context.translate(this.offsetX - cx, this.offsetY);\n            this.context.rotate(this.offsetRotation);\n            this.context.scale(this.offsetScale, this.offsetScale);\n            this.context.fill();\n            results.push(this.context.restore());\n          }\n          return results;\n        }\n  \n      };\n  \n      Kaleidoscope.prototype.HALF_PI = Math.PI / 2;\n  \n      Kaleidoscope.prototype.TWO_PI = Math.PI * 2;\n  \n      return Kaleidoscope;\n  \n    }).call(this);\n  \n    // Drag & Drop\n    DragDrop = class DragDrop {\n      constructor(callback, context = document, filter = /^image/i) {\n        var disable;\n        this.onDrop = this.onDrop.bind(this);\n        this.callback = callback;\n        this.context = context;\n        this.filter = filter;\n        disable = function(event) {\n          event.stopPropagation();\n          return event.preventDefault();\n        };\n        this.context.addEventListener('dragleave', disable);\n        this.context.addEventListener('dragenter', disable);\n        this.context.addEventListener('dragover', disable);\n        this.context.addEventListener('drop', this.onDrop, false);\n      }\n  \n      onDrop(event) {\n        var file, reader;\n        event.stopPropagation();\n        event.preventDefault();\n        file = event.dataTransfer.files[0];\n        if (this.filter.test(file.type)) {\n          reader = new FileReader;\n          reader.onload = (event) => {\n            return typeof this.callback === \"function\" ? this.callback(event.target.result) : void 0;\n          };\n          return reader.readAsDataURL(file);\n        }\n      }\n  \n    };\n  \n    // Init kaleidoscope\n    image = new Image;\n  \n    image.onload = () => {\n      return kaleidoscope.draw();\n    };\n  \n    image.src = 'dist/img/home/rose-kaleidoscope.png';\n  \n    kaleidoscope = new Kaleidoscope({\n      image: image,\n      slices: 20\n    });\n\n    kaleidoscope.domElement.style.display = 'flex';\n\n  \n    element.appendChild(kaleidoscope.domElement);\n  \n    \n    // Init drag & drop\n    dragger = new DragDrop(function(data) {\n      return kaleidoscope.image.src = data;\n    });\n  \n    \n    // Mouse events\n    tx = kaleidoscope.offsetX;\n  \n    ty = kaleidoscope.offsetY;\n  \n    tr = kaleidoscope.offsetRotation;\n  \n    onMouseMoved = (event) => {\n      var cx, cy, dx, dy, hx, hy;\n      cx = window.innerWidth / 2;\n      cy = window.innerHeight / 2;\n      dx = event.pageX / window.innerWidth;\n      dy = event.pageY / window.innerHeight;\n      hx = dx - 0.5;\n      hy = dy - 0.5;\n      tx = hx * kaleidoscope.radius * -2;\n      ty = hy * kaleidoscope.radius * 2;\n      return tr = Math.atan2(hy, hx);\n    };\n  \n    window.addEventListener('mousemove', onMouseMoved, false);\n  \n    \n    // Init\n    options = {\n      interactive: true,\n      ease: 0.1\n    };\n  \n    (update = () => {\n      var delta, theta;\n      if (options.interactive) {\n        delta = tr - kaleidoscope.offsetRotation;\n        theta = Math.atan2(Math.sin(delta), Math.cos(delta));\n        kaleidoscope.offsetX += (tx - kaleidoscope.offsetX) * options.ease;\n        kaleidoscope.offsetY += (ty - kaleidoscope.offsetY) * options.ease;\n        kaleidoscope.offsetRotation += (theta - kaleidoscope.offsetRotation) * options.ease;\n        kaleidoscope.draw();\n      }\n      return setTimeout(update, 1000 / 60);\n    })();\n  \n  \n    onChange = () => {\n      kaleidoscope.domElement.style.marginLeft = -kaleidoscope.radius + 'px';\n      kaleidoscope.domElement.style.marginTop = -kaleidoscope.radius + 'px';\n      options.interactive = false;\n      return kaleidoscope.draw();\n    };\n  \n    return kaleidoscope;\n  \n  }).bind(this)\n  \n\n// made the kaleidoscope IFFY into a callable fn\n// called it from vue mounted lifecycle hook, feeding in the element to put it in, from a vue ref\n// modified the kaleidoscope code to make it's image property available, so we can change the image src from the outside\n// in homeCOmponent, watched the chosenCrystal data (which changes when you mouse over a crystal big dot)\n// when chosenCrystal changes, tell the kaleidoscope's image's src to change to the homeKaleidoscope prop of the chosenCrystal object in the crystal data (from app.js)"]}